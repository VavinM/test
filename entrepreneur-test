<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–û—Ü–µ–Ω–∫–∞ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞ –º–æ–ª–æ–¥—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–µ–π</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f9f9f9; }
    h1 { text-align: center; }
    input[type="file"] { margin-bottom: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #eee; }
  </style>
</head>
<body>

<h1>–ê–Ω–∞–ª–∏–∑ –∞–Ω–∫–µ—Ç –ø–æ –º–µ—Ç–æ–¥–∏–∫–µ –æ—Ü–µ–Ω–∫–∏</h1>
<input type="file" accept=".csv" onchange="handleFile(event)">
<div id="output"></div>

<script>
const weights = {
  1: 8, 2: 7, 3: 6, 4: 7, 5: 5, 6: 8, 7: 7, 8: 6, 9: 5, 10: 6,
  11: 5, 12: 8, 13: 7, 14: 6, 15: 7, 16: 5, 17: 4, 18: 7, 19: 5,
  20: 4, 21: 7, 22: 5,
  23: 6, 24: 5, 25: 7, 26: 8, 27: 7, 28: 6, 29: 7, 30: 6, 31: 8
};

const mapping = {
  "–°–æ–≤—Å–µ–º –Ω–µ —É–≤–µ—Ä–µ–Ω": 1, "–ü–æ—á—Ç–∏ –Ω–∏–∫–æ–≥–¥–∞": 1, "–ù–µ –∏—Å–ø–æ–ª—å–∑—É—é": 1, "–ù–µ —Å–ø—Ä–∞–≤–ª—è—é—Å—å": 1,
  "–°–∫–æ—Ä–µ–µ –Ω–µ —É–≤–µ—Ä–µ–Ω": 2, "–†–µ–¥–∫–æ": 2, "–ò—Å–ø–æ–ª—å–∑—É—é —Ä–µ–¥–∫–æ": 2, "–° —Ç—Ä—É–¥–æ–º": 2,
  "–ò–Ω–æ–≥–¥–∞ —É–¥–∞—ë—Ç—Å—è": 3, "–ò–Ω–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è—é": 3, "–ò–Ω–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É—é": 3, "–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ": 3,
  "–ß–∞—Å—Ç–æ —É–¥–∞—ë—Ç—Å—è": 4, "–ò—Å–ø–æ–ª—å–∑—É—é —Ä–µ–≥—É–ª—è—Ä–Ω–æ": 4, "–•–æ—Ä–æ—à–æ —Å–ø—Ä–∞–≤–ª—è—é—Å—å": 4,
  "–ü–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ —É–¥–∞—ë—Ç—Å—è": 5, "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é": 5, "–û—Ç–ª–∏—á–Ω–æ —Å–ø—Ä–∞–≤–ª—è—é—Å—å": 5
};

function handleFile(event) {
  const reader = new FileReader();
  reader.onload = function () {
    const lines = reader.result.split('\n').map(line => line.split(','));
    const headers = lines[0];
    const rows = lines.slice(1).filter(r => r.length > 2);

    let html = `<table><tr><th>–§–ò–û</th><th>Soft %</th><th>Hard %</th><th>Total %</th><th>–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è</th></tr>`;
    
    rows.forEach(row => {
      const name = row[1];
      let softScore = 0, hardScore = 0, softMax = 0, hardMax = 0;

      for (let i = 1; i <= 31; i++) {
        const raw = row[i + 1]?.trim();
        const score = mapping[raw] || 0;
        const weight = weights[i] || 0;

        if (i <= 22) {
          softScore += score * weight;
          softMax += 5 * weight;
        } else {
          hardScore += score * weight;
          hardMax += 5 * weight;
        }
      }

      const softPct = Math.round((softScore / softMax) * 100);
      const hardPct = Math.round((hardScore / hardMax) * 100);
      const total = Math.round(softPct * 0.6 + hardPct * 0.4);

      let level = "üî¥ –ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å";
      if (total >= 85) level = "üü¢ –û—Ç–ª–∏—á–Ω–æ";
      else if (total >= 65) level = "üü° –•–æ—Ä–æ—à–æ";
      else if (total >= 45) level = "üü† –°—Ä–µ–¥–Ω–µ";

      html += `<tr><td>${name}</td><td>${softPct}</td><td>${hardPct}</td><td>${total}</td><td>${level}</td></tr>`;
    });

    html += `</table>`;
    document.getElementById("output").innerHTML = html;
  };

  reader.readAsText(event.target.files[0], 'UTF-8');
}
</script>

</body>
</html>
