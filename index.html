<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ê–Ω–∞–ª–∏–∑ –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º (—Å —Ä–∞–∑–±–∞–ª–æ–≤–∫–æ–π)</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial; padding: 24px; background: #f9f9f9; }
    h1 { text-align: center; }
    .warn { color: #b00; }
    .person { margin: 30px 0; background: #fff; border-radius: 10px; box-shadow: 0 2px 8px #0001; padding: 18px; }
    .scores, .answers { width: 100%; border-collapse: collapse; margin-top: 12px; }
    th, td { border: 1px solid #bbb; padding: 4px 8px; }
    th { background: #e9e9e9; }
    .answers th { background: #f8f8d7; }
    .warn-cell { background: #fff0f0; }
  </style>
</head>
<body>
  <h1>–î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–∞–∑–±–∞–ª–æ–≤–∫–∞ –ø–æ –∫–∞–∂–¥–æ–º—É –≤–æ–ø—Ä–æ—Å—É</h1>
  <input type="file" id="fileInput" accept=".xlsx,.csv">
  <div id="result"></div>
  <script>
const weights = [8,7,6,7,5,8,7,6,5,6,5,8,7,6,7,5,4,5,5,4,7,5,6,5,7,8,7,6,7,6,8];
const likertMapping = {
  '–°–æ–≤—Å–µ–º –Ω–µ —É–≤–µ—Ä–µ–Ω': 1, '–°–∫–æ—Ä–µ–µ –Ω–µ —É–≤–µ—Ä–µ–Ω': 2, '–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ': 3, '–°–∫–æ—Ä–µ–µ —É–≤–µ—Ä–µ–Ω': 4, '–ü–æ–ª–Ω–æ—Å—Ç—å—é —É–≤–µ—Ä–µ–Ω': 5,
  '–î–µ–º–æ–∫—Ä–∞—Ç–∏—á–µ—Å–∫–∏–π': 4, '–î–∏—Ä–µ–∫—Ç–∏–≤–Ω—ã–π': 2, '–°–∏—Ç—É–∞—Ç–∏–≤–Ω—ã–π': 5, '–õ–∏–±–µ—Ä–∞–ª—å–Ω—ã–π': 3, '–°–º–µ—à–∞–Ω–Ω—ã–π': 4,
  '–ü—Ä–æ–≤–æ–∂—É –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å': 5,
  '–ù–∞—Å—Ç–∞–∏–≤–∞—é –Ω–∞ —Å–≤–æ—ë–º —Ä–µ—à–µ–Ω–∏–∏, —Ç–∞–∫ –∫–∞–∫ —É–≤–µ—Ä–µ–Ω –≤ –µ–≥–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏': 2,
  '–ü–µ—Ä–µ—Å–º–∞—Ç—Ä–∏–≤–∞—é —Ä–µ—à–µ–Ω–∏–µ —Å —É—á—ë—Ç–æ–º –º–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã': 4,
  '–î–µ–ª–µ–≥–∏—Ä—É—é –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥–µ': 3,
  '–ò–≥–Ω–æ—Ä–∏—Ä—É—é –Ω–µ—Å–æ–≥–ª–∞—Å–∏–µ, —Ç–∞–∫ –∫–∞–∫ —Å—á–∏—Ç–∞—é –µ–≥–æ –Ω–µ–æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–º': 1,
  '–ü–æ—á—Ç–∏ –Ω–∏–∫–æ–≥–¥–∞': 1, '–†–µ–¥–∫–æ': 2, '–ò–Ω–æ–≥–¥–∞': 3, '–ß–∞—Å—Ç–æ': 4, '–ü–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞': 5,
  '–õ–µ–≥–∫–æ –∞–¥–∞–ø—Ç–∏—Ä—É—é—Å—å –∏ –Ω–∞—Ö–æ–∂—É –±–∞–ª–∞–Ω—Å': 5,
  '–°—Ç–∞—Ä–∞—é—Å—å —Ä–∞–∑–¥–µ–ª—è—Ç—å –ª–∏—á–Ω—É—é –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –∂–∏–∑–Ω—å': 4,
  '–û–±—Ä–∞—â–∞—é—Å—å –∑–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫ –∫–æ–ª–ª–µ–≥–∞–º –∏–ª–∏ –¥—Ä—É–∑—å—è–º': 3,
  '–ß—É–≤—Å—Ç–≤—É—é —Å—Ç—Ä–µ—Å—Å, –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞—é —Ä–∞–±–æ—Ç–∞—Ç—å': 2,
  '–¢–µ—Ä—è—é –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –Ω–µ –º–æ–≥—É —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏': 1,
  '–°–æ–≤—Å–µ–º –Ω–µ —É–º–µ—é': 1, '–†–µ–¥–∫–æ —É–¥–∞—ë—Ç—Å—è': 2, '–ò–Ω–æ–≥–¥–∞ —É–¥–∞—ë—Ç—Å—è': 3, '–ß–∞—Å—Ç–æ —É–¥–∞—ë—Ç—Å—è': 4, '–ü–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ —É–¥–∞—ë—Ç—Å—è': 5,
  // –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è Hard ‚Äî –î–æ–ø–æ–ª–Ω–∏, –µ—Å–ª–∏ –≤—Å—Ç—Ä–µ—Ç–∏—à—å –Ω–æ–≤—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã!
  '–ù–µ –∏—Å–ø–æ–ª—å–∑—É—é': 1, '–ò—Å–ø–æ–ª—å–∑—É—é —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏': 2, '–ò—Å–ø–æ–ª—å–∑—É—é –¥–ª—è –ª–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á': 2,
  '–ò—Å–ø–æ–ª—å–∑—É—é –¥–ª—è –∫–æ–º–∞–Ω–¥–Ω–æ–π —Ä–∞–±–æ—Ç—ã': 3, '–£–º–µ—é —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–∞–Ω–∞–ª—ã –∏ –≥—Ä—É–ø–ø—ã': 3, '–£–º–µ—é –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ workflows': 4,
  '–£–º–µ—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –¥—Ä—É–≥–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏': 4, '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è': 5,
  '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏': 5, '–î–∞': 5, '–ù–µ—Ç': 1
  '–û–±—Ä–∞—â–∞—é—Å—å –∑–∞ —Å–æ–≤–µ—Ç–æ–º –∫ —ç–∫—Å–ø–µ—Ä—Ç–∞–º': 3,
'–ò—Å–ø–æ–ª—å–∑—É—é —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤': 2,
'–ü—Ä–æ–≤–æ–∂—É –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –±–µ—Å–µ–¥—ã —Å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞': 4,
'–ò–Ω–æ–≥–¥–∞ —É–¥–∞—ë—Ç—Å—è –¥–æ—Å—Ç–∏—á—å —Å–æ–≥–ª–∞—à–µ–Ω–∏—è': 3,
'–£–ø—Ä–∞–≤–ª—è–ª(–∞) –ø—Ä–æ–µ–∫—Ç–∞–º–∏ —Å—Ä–µ–¥–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (3-12 –º–µ—Å—è—Ü–µ–≤)': 3,
'–•–æ—Ä–æ—à–æ': 4,
'–ò—Å–ø–æ–ª—å–∑—É—é —Å–ª–æ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è': 4,
'–£—á–∞—Å—Ç–≤–æ–≤–∞–ª(–∞) –≤ –æ–±—Å—É–∂–¥–µ–Ω–∏—è—Ö': 2,
'–£—Å–∫–æ—Ä—é –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á –∑–∞ —Å—á—ë—Ç –∫–∞—á–µ—Å—Ç–≤–∞': 2,
'–ò–Ω–æ–≥–¥–∞ –ø—Ä–æ—è–≤–ª—è—é –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å': 3,
'–ß—É–≤—Å—Ç–≤—É—é —Å–∏–ª—å–Ω—ã–π —Å—Ç—Ä–µ—Å—Å, –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞—é —Ä–∞–±–æ—Ç–∞—Ç—å': 2,
'–ß–∞—Å—Ç–æ —É–¥–∞—ë—Ç—Å—è –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è': 4,
'–£–ø—Ä–∞–≤–ª—è–ª(–∞) —Å—Ä–µ–¥–Ω–µ–π –∫–æ–º–∞–Ω–¥–æ–π (6-15 —á–µ–ª–æ–≤–µ–∫)': 3,
'Intermediate (B1)': 3,
'–ò—Å–ø–æ–ª—å–∑—É—é –¥–ª—è –ª–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á (–Ω–∞–ø—Ä–∏–º–µ—Ä, ChatGPT)': 2,
'–£–º–µ—é –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º': 3,
'–ò—Å–ø–æ–ª—å–∑—É—é –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã': 3,
'–£–º–µ—é —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø—Ä–æ—Å—Ç—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏': 2,
'–°–æ–∑–¥–∞—é –ø—Ä–æ—Å—Ç—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏': 3
    '–û–±—Ä–∞—â–∞—é—Å—å –∑–∞ —Å–æ–≤–µ—Ç–æ–º –∫ —ç–∫—Å–ø–µ—Ä—Ç–∞–º': 3,
  '–ò—Å–ø–æ–ª—å–∑—É—é —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤': 2,
  '–ü—Ä–æ–≤–æ–∂—É –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –±–µ—Å–µ–¥—ã —Å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞': 4,
  '–ò–Ω–æ–≥–¥–∞ —É–¥–∞—ë—Ç—Å—è –¥–æ—Å—Ç–∏—á—å —Å–æ–≥–ª–∞—à–µ–Ω–∏—è': 3,
  '–£–ø—Ä–∞–≤–ª—è–ª(–∞) –ø—Ä–æ–µ–∫—Ç–∞–º–∏ —Å—Ä–µ–¥–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (3-12 –º–µ—Å—è—Ü–µ–≤)': 3,
  '–•–æ—Ä–æ—à–æ': 4,
  '–ò—Å–ø–æ–ª—å–∑—É—é —Å–ª–æ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è': 4,
  '–£—á–∞—Å—Ç–≤–æ–≤–∞–ª(–∞) –≤ –æ–±—Å—É–∂–¥–µ–Ω–∏—è—Ö': 2,
  '–£—Å–∫–æ—Ä—é –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á –∑–∞ —Å—á—ë—Ç –∫–∞—á–µ—Å—Ç–≤–∞': 2,
  '–ò–Ω–æ–≥–¥–∞ –ø—Ä–æ—è–≤–ª—è—é –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å': 3,
  '–ß—É–≤—Å—Ç–≤—É—é —Å–∏–ª—å–Ω—ã–π —Å—Ç—Ä–µ—Å—Å, –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞—é —Ä–∞–±–æ—Ç–∞—Ç—å': 2,
  '–ß–∞—Å—Ç–æ —É–¥–∞—ë—Ç—Å—è –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è': 4,
  '–£–ø—Ä–∞–≤–ª—è–ª(–∞) —Å—Ä–µ–¥–Ω–µ–π –∫–æ–º–∞–Ω–¥–æ–π (6-15 —á–µ–ª–æ–≤–µ–∫)': 3,
  'Intermediate (B1)': 3,
  '–ò—Å–ø–æ–ª—å–∑—É—é –¥–ª—è –ª–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á (–Ω–∞–ø—Ä–∏–º–µ—Ä, ChatGPT)': 2,
  '–£–º–µ—é –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º': 3,
  '–ò—Å–ø–æ–ª—å–∑—É—é –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã': 3,
  '–£–º–µ—é —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø—Ä–æ—Å—Ç—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏': 2,
  '–°–æ–∑–¥–∞—é –ø—Ä–æ—Å—Ç—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏': 3,
};

// –ù–∞–∑–≤–∞–Ω–∏—è –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º
const questionLabels = Array.from({length: 31}, (_,i) => `–í–æ–ø—Ä–æ—Å ${i+1}`);

function handleFile(file) {
  const reader = new FileReader();
  reader.onload = function(e) {
    let data;
    if (file.name.endsWith('.csv')) {
      const text = e.target.result;
      data = text.split(/\r?\n/).map(r=>r.split(';').map(x=>x.trim()));
    } else {
      const workbook = XLSX.read(e.target.result, {type: 'array'});
      const sheet = workbook.Sheets[workbook.SheetNames[0]];
      data = XLSX.utils.sheet_to_json(sheet, {header:1});
    }
    showResults(data);
  };
  if (file.name.endsWith('.csv')) reader.readAsText(file, 'utf-8');
  else reader.readAsArrayBuffer(file);
}

function showResults(data) {
  let html = '';
  let notFoundSet = new Set();
  data.slice(1).forEach((row, rowIdx) => {
    const name = (row[1] || row[0] || '‚Äî').toString().trim();
    let softScore = 0, hardScore = 0, softMax = 0, hardMax = 0;
    let answerRows = '';
    for (let i = 0; i < weights.length; i++) {
      const ans = (row[i + 3] || '').replace(/^\"|\"$/g, '').trim();
      const value = likertMapping[ans] !== undefined ? likertMapping[ans] : 0;
      if (likertMapping[ans] === undefined && ans !== '') notFoundSet.add(ans);
      const cellClass = likertMapping[ans] === undefined && ans !== '' ? 'warn-cell' : '';
      answerRows += `<tr><td>${questionLabels[i]}</td><td>${ans}</td><td class='${cellClass}'>${value}${cellClass ? ' <span class=\"warn\">(–Ω–µ—Ç —Ä–∞–∑–±–∞–ª–æ–≤–∫–∏!)</span>' : ''}</td></tr>`;
      const weight = weights[i];
      if (i < 22) {
        softScore += value * weight;
        softMax += 5 * weight;
      } else {
        hardScore += value * weight;
        hardMax += 5 * weight;
      }
    }
    const softPct = Math.round((softScore / softMax) * 100);
    const hardPct = Math.round((hardScore / hardMax) * 100);
    const total = Math.round(softPct * 0.6 + hardPct * 0.4);
    let interp = 'üî¥ –ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å';
    if (total >= 85) interp = 'üü¢ –û—Ç–ª–∏—á–Ω–æ ‚Äì –∑—Ä–µ–ª—ã–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏';
    else if (total >= 65) interp = 'üü° –•–æ—Ä–æ—à–æ ‚Äì –µ—Å—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª';
    else if (total >= 45) interp = 'üü† –°—Ä–µ–¥–Ω–µ ‚Äì —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–∑–≤–∏—Ç–∏–µ';

    html += `<div class='person'><b>${name}</b>
    <table class='scores'><tr><th>Soft %</th><th>Hard %</th><th>Total %</th><th>–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è</th></tr>
    <tr><td>${softPct}</td><td>${hardPct}</td><td>${total}</td><td>${interp}</td></tr></table>
    <details><summary>–†–∞–∑–±–∞–ª–ª–æ–≤–∫–∞ –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º</summary>
    <table class='answers'><tr><th>–í–æ–ø—Ä–æ—Å</th><th>–û—Ç–≤–µ—Ç</th><th>–ë–∞–ª–ª</th></tr>
    ${answerRows}
    </table></details></div>`;
  });

  if (notFoundSet.size > 0) {
    html = `<div class='warn'><b>–í–Ω–∏–º–∞–Ω–∏–µ!</b> –ï—Å—Ç—å –æ—Ç–≤–µ—Ç—ã –±–µ–∑ —Ä–∞–∑–±–∞–ª–æ–≤–∫–∏ (${notFoundSet.size}):<br>${Array.from(notFoundSet).map(x=>`<code>${x}</code>`).join(', ')}</div>` + html;
  }
  document.getElementById('result').innerHTML = html;
}

document.getElementById('fileInput').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (file) handleFile(file);
});
  </script>
</body>
</html>
