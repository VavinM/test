<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–¢–µ—Å—Ç –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #fafafa; }
    h1 { text-align: center; }
    #fioSelect { margin-bottom: 20px; }
    .warning { color: #b71c1c; background: #fde0e0; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 30px; }
    th, td { border: 1px solid #ccc; padding: 7px; }
    th { background: #eee; }
    .result-block { font-size: 1.2em; margin-bottom: 20px; }
    .score { font-size: 1.4em; font-weight: bold; margin: 10px 0; }
    .level { font-weight: bold; }
    .low { color: #b71c1c; }
    .medium { color: #ff9800; }
    .good { color: #2196f3; }
    .high { color: #388e3c; }
    .centered { text-align: center; }
  </style>
</head>
<body>
  <h1>–¢–µ—Å—Ç –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π</h1>
  <input type="file" id="fileInput" accept=".xlsx,.csv">
  <br>
  <label for="fioSelect"><b>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ—Å–ø–æ–Ω–¥–µ–Ω—Ç–∞:</b></label>
  <select id="fioSelect"></select>
  <div id="personResult"></div>
  <div id="details"></div>
  <div id="summary"></div>
  <script>
    // === –†–∞–∑–±–∞–ª–ª–æ–≤–∫–∞ ===
    const likertMapping = {
      "–°–æ–≤—Å–µ–º –Ω–µ —É–≤–µ—Ä–µ–Ω": 1,
      "–°–∫–æ—Ä–µ–µ –Ω–µ —É–≤–µ—Ä–µ–Ω": 2,
      "–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ": 3,
      "–°–∫–æ—Ä–µ–µ —É–≤–µ—Ä–µ–Ω": 4,
      "–ü–æ–ª–Ω–æ—Å—Ç—å—é —É–≤–µ—Ä–µ–Ω": 5,
      "–î–µ–º–æ–∫—Ä–∞—Ç–∏—á–µ—Å–∫–∏–π": 4,
      "–î–∏—Ä–µ–∫—Ç–∏–≤–Ω—ã–π": 2,
      "–°–∏—Ç—É–∞—Ç–∏–≤–Ω—ã–π": 5,
      "–õ–∏–±–µ—Ä–∞–ª—å–Ω—ã–π": 3,
      "–°–º–µ—à–∞–Ω–Ω—ã–π": 4,
      "–ü—Ä–æ–≤–æ–∂—É –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å": 5,
      "–ù–∞—Å—Ç–∞–∏–≤–∞—é –Ω–∞ —Å–≤–æ—ë–º —Ä–µ—à–µ–Ω–∏–∏, —Ç–∞–∫ –∫–∞–∫ —É–≤–µ—Ä–µ–Ω –≤ –µ–≥–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏": 2,
      "–ü–µ—Ä–µ—Å–º–∞—Ç—Ä–∏–≤–∞—é —Ä–µ—à–µ–Ω–∏–µ —Å —É—á—ë—Ç–æ–º –º–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã": 4,
      "–î–µ–ª–µ–≥–∏—Ä—É—é –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥–µ": 3,
      "–ò–≥–Ω–æ—Ä–∏—Ä—É—é –Ω–µ—Å–æ–≥–ª–∞—Å–∏–µ, —Ç–∞–∫ –∫–∞–∫ —Å—á–∏—Ç–∞—é –µ–≥–æ –Ω–µ–æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–º": 1,
      "–ü–æ—á—Ç–∏ –Ω–∏–∫–æ–≥–¥–∞": 1,
      "–†–µ–¥–∫–æ": 2,
      "–ò–Ω–æ–≥–¥–∞": 3,
      "–ß–∞—Å—Ç–æ": 4,
      "–ü–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞": 5,
      "–õ–µ–≥–∫–æ –∞–¥–∞–ø—Ç–∏—Ä—É—é—Å—å –∏ –Ω–∞—Ö–æ–∂—É –±–∞–ª–∞–Ω—Å": 5,
      "–°—Ç–∞—Ä–∞—é—Å—å —Ä–∞–∑–¥–µ–ª—è—Ç—å –ª–∏—á–Ω—É—é –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –∂–∏–∑–Ω—å": 4,
      "–û–±—Ä–∞—â–∞—é—Å—å –∑–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫ –∫–æ–ª–ª–µ–≥–∞–º –∏–ª–∏ –¥—Ä—É–∑—å—è–º": 3,
      "–ß—É–≤—Å—Ç–≤—É—é —Å—Ç—Ä–µ—Å—Å, –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞—é —Ä–∞–±–æ—Ç–∞—Ç—å": 2,
      "–¢–µ—Ä—è—é –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –Ω–µ –º–æ–≥—É —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏": 1,
      "–°–æ–≤—Å–µ–º –Ω–µ —É–º–µ—é": 1,
      "–†–µ–¥–∫–æ —É–¥–∞—ë—Ç—Å—è": 2,
      "–ò–Ω–æ–≥–¥–∞ —É–¥–∞—ë—Ç—Å—è": 3,
      "–ß–∞—Å—Ç–æ —É–¥–∞—ë—Ç—Å—è": 4,
      "–ü–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ —É–¥–∞—ë—Ç—Å—è": 5,
      "–ù–µ—Ç": 1,
      "–î–∞": 5,
      // –î–û–ë–ê–í–õ–ï–ù–´ –Ω–æ–≤—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
      "Intermediate (B1)": 3,
      "–£–º–µ—é —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–∞–Ω–∞–ª—ã –∏ –≥—Ä—É–ø–ø—ã": 3,
      "–ò—Å–ø–æ–ª—å–∑—É—é –¥–ª—è –ª–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á": 2,
      "–£—á–∞—Å—Ç–≤–æ–≤–∞–ª(–∞) –≤ –æ–±—Å—É–∂–¥–µ–Ω–∏—è—Ö": 3,
      "–£–ø—Ä–∞–≤–ª—è–ª(–∞) –ø—Ä–æ–µ–∫—Ç–∞–º–∏ —Å—Ä–µ–¥–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (3-12 –º–µ—Å—è—Ü–µ–≤)": 3,
      "–•–æ—Ä–æ—à–æ": 4,
      "–ò—Å–ø–æ–ª—å–∑—É—é —Å–ª–æ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è": 4,
      "–û–±—Ä–∞—â–∞—é—Å—å –∑–∞ —Å–æ–≤–µ—Ç–æ–º –∫ —ç–∫—Å–ø–µ—Ä—Ç–∞–º": 3,
      "–ò—Å–ø–æ–ª—å–∑—É—é —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤": 2,
      "–ü—Ä–æ–≤–æ–∂—É –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –±–µ—Å–µ–¥—ã —Å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞": 4,
      "–ò–Ω–æ–≥–¥–∞ —É–¥–∞—ë—Ç—Å—è –¥–æ—Å—Ç–∏—á—å —Å–æ–≥–ª–∞—à–µ–Ω–∏—è": 3,
      "–£–ø—Ä–∞–≤–ª—è–ª(–∞) —Å—Ä–µ–¥–Ω–µ–π –∫–æ–º–∞–Ω–¥–æ–π (6-15 —á–µ–ª–æ–≤–µ–∫)": 4,
      "–£–º–µ—é –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º": 3,
      "–ò—Å–ø–æ–ª—å–∑—É—é –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã": 3,
      "–£–º–µ—é —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø—Ä–æ—Å—Ç—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏": 2,
      "–°–æ–∑–¥–∞—é –ø—Ä–æ—Å—Ç—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏": 3,
      // ... –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî —Ä–∞—Å—à–∏—Ä—è–π –¥–∞–ª–µ–µ!
    };

    // –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –≤–µ—Å–∞ –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º (31 –≤–æ–ø—Ä–æ—Å)
    const weights = [8,7,6,7,5,8,7,6,5,6,5,8,7,6,7,5,4,5,5,4,7,5,6,5,7,8,7,6,7,6,8];

    let persons = [];
    let header = [];
    let answers = [];

    document.getElementById('fileInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) handleFile(file);
    });

    document.getElementById('fioSelect').addEventListener('change', function() {
      displayPerson(this.value);
    });

    // –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: –ø–∞—Ä—Å–∏–Ω–≥ —Ñ–∞–π–ª–∞
    function handleFile(file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        let data, workbook, sheet, json;
        if (file.name.endsWith('.csv')) {
          data = e.target.result;
          json = XLSX.utils.sheet_to_json(XLSX.read(data, {type: 'string'}).Sheets.Sheet1, {header: 1});
        } else {
          data = new Uint8Array(e.target.result);
          workbook = XLSX.read(data, { type: 'array' });
          sheet = workbook.Sheets[workbook.SheetNames[0]];
          json = XLSX.utils.sheet_to_json(sheet, { header: 1 });
        }
        processData(json);
      };
      if (file.name.endsWith('.csv')) reader.readAsText(file);
      else reader.readAsArrayBuffer(file);
    }

    // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    function processData(data) {
      persons = [];
      header = data[0];
      answers = [];
      let fioCol = header.findIndex(col => col && col.toLowerCase().includes('—Ñ–∏–æ'));
      if (fioCol === -1) fioCol = header.findIndex(col => col && (col.toLowerCase().includes('—Ñ–∞–º–∏–ª–∏—è') || col.toLowerCase().includes('–∏–º—è')));
      if (fioCol === -1) fioCol = 1; // fallback

      // –û–ø—Ä–µ–¥–µ–ª–∏–º —Å—Ç–æ–ª–±—Ü—ã —Å –æ—Ç–≤–µ—Ç–∞–º–∏
      let answerStart = fioCol + 1;
      // –æ—Ç—Ä–µ–∂–µ–º —Å—Ç—Ä–æ–∫–∏ —Å –ø—É—Å—Ç—ã–º –§–ò–û
      data.slice(1).forEach(row => {
        if (row[fioCol] && row[fioCol].toString().trim().length > 0) {
          persons.push(row[fioCol].toString().trim());
          answers.push(row.slice(answerStart, answerStart + 31));
        }
      });
      // –ó–∞–ø–æ–ª–Ω—è–µ–º select
      let fioSelect = document.getElementById('fioSelect');
      fioSelect.innerHTML = '';
      persons.forEach((fio, i) => {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = fio;
        fioSelect.appendChild(opt);
      });
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–µ—Ä–≤–æ–≥–æ —Ä–µ—Å–ø–æ–Ω–¥–µ–Ω—Ç–∞
      displayPerson(0);
      // –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
      displaySummary();
    }

    // –í—ã–≤–æ–¥ —Ä–∞–∑–±–∞–ª–æ–≤–∫–∏ –ø–æ –æ–¥–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    function displayPerson(idx) {
      if (!answers[idx]) return;
      const ans = answers[idx];
      let details = `<h3 class="centered">${persons[idx]}</h3>`;
      details += `<table><tr><th>–í–æ–ø—Ä–æ—Å</th><th>–û—Ç–≤–µ—Ç</th><th>–ë–∞–ª–ª</th></tr>`;
      let softScore = 0, hardScore = 0, softMax = 0, hardMax = 0;
      for (let i = 0; i < ans.length; i++) {
        let a = (ans[i] || '').toString().trim();
        let val = (a in likertMapping) ? likertMapping[a] : 0;
        const weight = weights[i];
        let className = '';
        if (!(a in likertMapping)) className = 'warning';
        if (i < 22) {
          softScore += val * weight;
          softMax += 5 * weight;
        } else {
          hardScore += val * weight;
          hardMax += 5 * weight;
        }
        details += `<tr class="${className}"><td>–í–æ–ø—Ä–æ—Å ${i+1}</td><td>${a}</td><td>${val}${className ? ' (–Ω–µ—Ç —Ä–∞–∑–±–∞–ª–æ–≤–∫–∏!)' : ''}</td></tr>`;
      }
      details += '</table>';
      document.getElementById('details').innerHTML = details;
      showPersonResult(softScore, hardScore, softMax, hardMax);
    }

    // –ë–ª–æ–∫ –∏—Ç–æ–≥–æ–≤—ã—Ö –±–∞–ª–ª–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ä–µ—Å–ø–æ–Ω–¥–µ–Ω—Ç—É
    function showPersonResult(softScore, hardScore, softMax, hardMax) {
      const softPct = Math.round((softScore / softMax) * 100);
      const hardPct = Math.round((hardScore / hardMax) * 100);
      const total = Math.round(softPct * 0.6 + hardPct * 0.4);
      let level = `<span class="level low">üî¥ –ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å</span>`;
      if (total >= 85) level = `<span class="level high">üü¢ –û—Ç–ª–∏—á–Ω–æ ‚Äì –∑—Ä–µ–ª—ã–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏</span>`;
      else if (total >= 65) level = `<span class="level good">üü° –•–æ—Ä–æ—à–æ ‚Äì –µ—Å—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª</span>`;
      else if (total >= 45) level = `<span class="level medium">üü† –°—Ä–µ–¥–Ω–µ ‚Äì —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–∑–≤–∏—Ç–∏–µ</span>`;
      document.getElementById('personResult').innerHTML = `
        <div class="result-block centered">
          <div>Soft skills: <span class="score">${softPct}%</span></div>
          <div>Hard skills: <span class="score">${hardPct}%</span></div>
          <div>–û–±—â–∏–π –±–∞–ª–ª: <span class="score">${total}%</span></div>
          <div>–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è: ${level}</div>
        </div>
      `;
    }

    // –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ –≤—Å–µ–º
    function displaySummary() {
      let out = '<h3>–°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ –≤—Å–µ–º —Ä–µ—Å–ø–æ–Ω–¥–µ–Ω—Ç–∞–º</h3>';
      out += `<table><tr><th>–§–ò–û</th><th>Soft %</th><th>Hard %</th><th>Total %</th><th>–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è</th></tr>`;
      answers.forEach((ans, idx) => {
        let softScore = 0, hardScore = 0, softMax = 0, hardMax = 0;
        for (let i = 0; i < ans.length; i++) {
          let a = (ans[i] || '').toString().trim();
          let val = (a in likertMapping) ? likertMapping[a] : 0;
          const weight = weights[i];
          if (i < 22) {
            softScore += val * weight;
            softMax += 5 * weight;
          } else {
            hardScore += val * weight;
            hardMax += 5 * weight;
          }
        }
        const softPct = Math.round((softScore / softMax) * 100);
        const hardPct = Math.round((hardScore / hardMax) * 100);
        const total = Math.round(softPct * 0.6 + hardPct * 0.4);
        let level = `üî¥ –ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å`;
        if (total >= 85) level = `üü¢ –û—Ç–ª–∏—á–Ω–æ ‚Äì –∑—Ä–µ–ª—ã–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏`;
        else if (total >= 65) level = `üü° –•–æ—Ä–æ—à–æ ‚Äì –µ—Å—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª`;
        else if (total >= 45) level = `üü† –°—Ä–µ–¥–Ω–µ ‚Äì —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–∑–≤–∏—Ç–∏–µ`;
        out += `<tr><td>${persons[idx]}</td><td>${softPct}</td><td>${hardPct}</td><td>${total}</td><td>${level}</td></tr>`;
      });
      out += '</table>';
      document.getElementById('summary').innerHTML = out;
    }
  </script>
</body>
</html>
